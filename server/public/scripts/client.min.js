var myApp=angular.module("myApp",["ngRoute"]);myApp.config(["$routeProvider","$locationProvider",function(a,b){b.hashPrefix(""),a.when("/login",{templateUrl:"/views/templates/login.html",controller:"LoginController"}).when("/register",{templateUrl:"/views/templates/register.html",controller:"LoginController"}).when("/user",{templateUrl:"/views/templates/user.html",controller:"UserController",resolve:{getuser:["UserService",function(a){return a.getuser()}]}}).when("/newstudent",{templateUrl:"/views/templates/newstudent.html",controller:"StudentController",resolve:{getuser:["UserService",function(a){return a.getuser()}]}}).when("/addlesson",{templateUrl:"/views/templates/addlesson.html",controller:"LessonController",resolve:{getuser:["UserService",function(a){return a.getuser()}]}}).when("/updatelesson",{templateUrl:"/views/templates/updatelesson.html",controller:"LessonController",resolve:{getuser:["UserService",function(a){return a.getuser()}]}}).when("/mystudent",{templateUrl:"/views/templates/mystudent.html",controller:"LessonController",resolve:{getuser:["UserService",function(a){return a.getuser()}]}}).otherwise({redirectTo:"login"})}]),myApp.controller("LessonController",["$scope","$http","$location","UserService","StudentService","MailService","AlertService",function(a,b,c,d,e,f,g){a.getStudents=e.getStudents,a.getStudents(),a.userObject=d.userObject,a.logout=d.logout,a.studentObject=e.studentObject,a.studentList=e.studentList,a.lessonList=e.lessonList,a.lessonObject=e.lessonObject,a.getLessons=e.getLessons,a.addLesson=e.addLesson,a.sendEmail=f.sendEmail,a.lessonObject=e.lessonObject,a.viewDetails=e.viewDetails,a.sweetAlertModal=g.sweetAlertModal,a.lesson={},a.editing={status:"FALSE"},a.changeEditing=function(){a.editing.status="TRUE",a.lesson.id=a.lessonObject.data.id,a.lesson.assigned="FALSE",a.lesson.date=a.lessonObject.data.date,a.lesson.email=a.lessonObject.data.email,a.lesson.student=a.lessonObject.data.student},a.deleteLesson=function(d){b.delete("/lesson/"+d.id).then(function(a){console.log("back from the server with success!",a)}),a.sweetAlertModal("No prob, bob!","Just like that, your lesson has been deleted."),c.path("/user")},a.saveLesson=function(d){console.log("logging lesson in save lesson: ",d),a.lesson=d,d.date=moment(d.date).calendar("days"),b.post("/lesson",d).then(function(a){console.log(a),c.path("/user")}),d.notify?(a.sendEmail(d),a.sweetAlertModal("Success!","Sweet, your lesson has been added & your student has been emailed!","success")):a.sweetAlertModal("Success!","Sweet, your lesson has been added!","success")},a.getLessons(),a.assignLesson=function(d){a.sendEmail(d),b.put("/lesson/assign/"+d.id).then(function(b){c.path("/user"),a.sweetAlertModal("Success!","Sweet, your lesson has been emailed!")})},a.updateLesson=function(d){d.date=moment(d.date).calendar("days"),b.put("/lesson/update/"+d.id,d).then(function(b){c.path("/mystudent"),a.sweetAlertModal("Success!","Awesome, your lesson has been updated!")})}}]),myApp.controller("LoginController",["$scope","$http","$location","UserService",function(a,b,c,d){a.user={username:"",password:"",name:""},a.message="",a.login=function(){""===a.user.username||""===a.user.password?a.message="Please enter your username and password.":(console.log("sending to server...",a.user),b.post("/",a.user).then(function(b){b.data.username?(console.log("success: ",b.data),c.path("/user")):(console.log("failure: ",b),a.message="Invalid Credentials - Please try again!")}))},a.registerUser=function(){""===a.user.username||""===a.user.password?a.message="Please Choose a username and password":(console.log("sending to server...",a.user),b.post("/register",a.user).then(function(a){console.log("success"),c.path("/home")},function(b){console.log("error"),a.message="Please try again"}))}}]),myApp.controller("StudentController",["$scope","$http","$location","UserService",function(a,b,c,d){a.userObject=d.userObject,a.daysArray=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a.logout=d.logout,a.student={name:"",email:"",instrument:"",day:""},sweetAlert=function(){swal({title:"Success!",text:"Sweet, your student has been added!",type:"success"})},a.addStudent=function(d){d.teacher=a.userObject.id,b.post("/student",d).then(function(a){console.log("back from the server with success!",a),c.path("/user"),sweetAlert()})}}]),myApp.controller("UserController",["$scope","$http","$location","UserService","StudentService",function(a,b,c,d,e){a.userObject=d.userObject,a.logout=d.logout,a.getStudents=e.getStudents,a.studentList=e.studentList,a.studentObject=e.studentObject,a.studentView=e.studentView,a.addLesson=e.addLesson,a.getStudents(),a.orderByCategory="name",a.changeOrderBy=function(b){a.orderByCategory=b},a.newStudent=function(){c.path("/newstudent")}}]),myApp.factory("AlertService",["$http","$location",function(a,b){function c(a,b){swal({title:a,text:b,type:"success"})}return{sweetAlertModal:c}}]),myApp.factory("MailService",["$http",function(a){function b(b){console.log("Info in sendEmail function: ",b),b.assigned="TRUE",console.log("Updated info in sendEmail function: ",b),a.post("/nodemailer",b).then(function(a){console.log("Email has been sent: ",a.data)})}return{sendEmail:b}}]),myApp.factory("StudentService",["$http","$location",function(a,b){function c(){a.get("/student").then(function(a){h.students=a.data,console.log("studentList in getStudents: ",h)})}function d(a){i.data=a,b.path("/mystudent")}function e(){a.get("/lesson").then(function(a){j.lessons=a.data})}function f(){b.path("/addlesson")}function g(a){k.data=a,b.path("/updatelesson")}var h={students:[]},i={data:""},j={lessons:[]},k={data:""};return{studentList:h,getStudents:c,studentObject:i,studentView:d,lessonList:j,lessonObject:k,getLessons:e,addLesson:f,viewDetails:g}}]),myApp.factory("UserService",["$http","$location",function(a,b){console.log("User Service Loaded");var c={};return{userObject:c,getuser:function(){a.get("/user").then(function(a){a.data.username?(c.id=a.data.id,c.userName=a.data.username,c.name=a.data.name,console.log("User userName, id, and name: ",c.userName,c.id,c.name)):b.path("/login")})},logout:function(){a.get("/user/logout").then(function(a){console.log("logged out"),b.path("/login")})}}}]);